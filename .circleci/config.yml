#########################################################
################ DO NOT EDIT THIS FILE ##################
#########################################################

version: 2.1

workflows:
  build-and-test:
    jobs:
      - build-and-test:
          context:
            - proxy
            - docker-hub
executors:
  idatarepo:
    docker:
      - image: python:3.10-slim
    
jobs:
  build-and-test:
    executor: idatarepo
    steps:
      - checkout:
          path: /tmp/scrape
      - run:
          name: Setup Workspace
          command: mv /tmp/scrape/* ./ && chmod -R 777 ./
      - run:
          name: Configure Setup
          command: if [ -e setup.sh ]; then ./setup.sh; else echo "No setup.sh found"; fi
      - run:
          name: Install Requirements
          command: pip3 install -r requirements.txt
      - run:
          name: Validate Uploaded Data
          command: python validate.py "data/**/*.csv" config/schema.json
      - run:
          name: Run Scrape
          command: docker-entrypoint.sh bin/run.sh data/output.csv
      - run:
          name: Validate Scrape Output
          command: python validate.py data/output.csv config/schema.json
